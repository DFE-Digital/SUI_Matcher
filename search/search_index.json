{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Introduction","text":"<p>The NHS Number Matcher Pilot is a tool that allows for person records to be matched against NHS numbers held on the NHS SPINE, via the PDS FHIR API.</p> <p>Check out the architecture section for further information.</p> <p>Note</p> <p>This project is under active development.</p>"},{"location":"#goals","title":"Goals","text":"<p>The key goals of this project are:</p> <ul> <li>Improve matching processes for NHS numbers</li> <li>Evaluate how good the match rate is</li> <li>Understand any IG challenges</li> </ul>"},{"location":"adrs/","title":"Architecture Decision Records","text":"<p>ADR documentation will be hosted in our github repo.</p> ID Date Decision Status 001 2024-01-31 Initial Tech Choices Accepted 002 2025-04-16 Distribution Strategy for .NET CLI Client Tools Accepted"},{"location":"architecture/","title":"Architecture","text":"<p>These are the architecture documents.</p>"},{"location":"architecture/#constraints-and-principals","title":"Constraints and Principals","text":"<p>This project is aimed at providing a solution for Local Authorities that require more accurate matching capabilities.</p> <p>It requires a use-case to be agreed with NHS England to allow the use of the PDS FHIR API. This will require a number of governance steps to be followed, such as the DTAC.</p> <p>The PDS FHIR API has a limitation of 5 transactions per second for requests, and the \"fallback\" logic used in the pilot means each match to a person may use greater than 1 request. This means the PDS FHIR API is expected to initially be the biggest bottleneck for performance.</p> <p>For principles, please refer to the DfE Technical Guidance and Secure by Design Principles.</p>"},{"location":"architecture/#high-level-logical-architecture","title":"High Level Logical Architecture","text":"<pre><code>C4Container\n    title High Level Components - NHS SUI\n    Container_Boundary(c1, \"Local Authority\") {\n        System(laclient, \"Local Authority Client\")\n        System(sui_matching_service, \"Sui Matching Service\")\n        ContainerDb(db, \"File Storage\", \"Liquid Logic Output\")\n    }\n    Container_Boundary(c2, \"NHS Services\") {\n        System(nhs_fhir_api, \"NHS PDS FHIR API\")\n        System(nhs_auth_api, \"NHS PDS Auth API\")\n    }\n\n    Rel(laclient, db, \"Gets File\")\n    Rel(laclient, sui_matching_service, \"HTTPS\")\n    Rel(sui_matching_service, nhs_fhir_api, \"HTTPS\")\n    Rel(sui_matching_service, nhs_auth_api, \"HTTPS\")\n</code></pre>"},{"location":"architecture/#systems-architecture","title":"Systems Architecture","text":""},{"location":"architecture/#physical-view","title":"Physical View","text":""},{"location":"architecture/#definitions","title":"Definitions","text":"<p>Liquid Logic Server (Local Authority owned and run): Case management system used for recording referrals. Contains records with demographic information about referrals.</p> <p>File Storage (Local Authority owned and run): Server that will contain the file with the source information.</p> <p>Client Tool (New Component): A tool that takes the input file from the file storage and loops through the rows of data making a request to the SUI matching service. It outputs a results of the matching process and extra information about it.</p> <p>SUI Resource Group (New Component): Represents the application that will be deployed in a Local Authority.</p>"},{"location":"architecture/#step-by-step-flow-happy-path","title":"Step by Step Flow Happy Path","text":"<ol> <li>A nightly batch job runs that outputs a CSV file to an accessible location.</li> <li>The client tool periodically checks for a new file.</li> <li>When a new file is present it consumes it and starts to process the data.</li> <li>The client loops through the records in the file and extracts the information needed to be able to make an API call    against the SUI Matching Service via a private endpoint.</li> <li>The SUI Matching Service ingress controller (reverse proxy) accepts the request and forwards it onto the service.</li> <li>The SUI Service validates the data.</li> <li>With valid data it then checks authentication is in place to make a request to the NHS.</li> <li>With valid data and a valid authentication token it then makes one or more calls to the NHS PDS FHIR API to retrieve    a NHS number. This call is made over the internet.</li> <li>The returned results are examined and then returned to the client.</li> <li>The client outputs the data to a results CSV file (NHS numbers alongside the data) and a metadata CSV file that     gives further information on the process and input data.</li> </ol>"},{"location":"architecture/#sequence-diagram","title":"Sequence Diagram","text":"<pre><code>sequenceDiagram\n    box Client Tooling\n        participant client as Client Tool\n    end\n    box SUI Service\n        participant suimatch as SUI Matching Service\n        participant suiexternal as SUI External Service\n        participant suiauth as SUI Auth Service\n    end\n    box NHS Services\n        participant nhsauth as NHS AUTH API\n        participant nhssearch as NHS FHIR API\n    end\n\n    client -&gt;&gt;+ suimatch: Sends record to be validated and matched\n    loop Validate Data\n        suimatch -&gt;&gt; suimatch: Validate the data sent\n        alt Invalid Data\n            suimatch --&gt;&gt; client: Data invalid end process\n        else Valid Data\n            suimatch -&gt;&gt;+ suiexternal: Sends query so a request can be made\n        end\n    end\n    suiexternal -&gt;&gt;+ suiauth: Checks authentication status\n    alt Token Does Not Exist\n        suiauth -&gt;&gt; nhsauth: Get new token\n        nhsauth --&gt;&gt; suiauth: Return new token\n    else Token Exists\n        suiauth --&gt;&gt; suiexternal: Token available to return\n    end\n    suiexternal -&gt;&gt; nhssearch: Makes request to NHS service\n    nhssearch --&gt;&gt; suiexternal: Returns data\n    suiexternal --&gt;&gt;- suimatch: Passes response to be formatted\n    suimatch --&gt;&gt;- client: Returns data to client to be output\n\n</code></pre>"},{"location":"architecture/#application-architecture","title":"Application Architecture","text":""},{"location":"architecture/#container-diagram","title":"Container diagram","text":"<pre><code>C4Container\n    title Container diagram for SUI Matcher\n    System(laclient, \"Local Authority Client\", \"The client to connect to the service\")\n\n    Container_Boundary(c1, \"Sui Matching Service\") {\n        Container(reverse_proxy, \"Gateway\", \"C#, .NET 8, YARP\", \"The reverse proxy/API gateway of the SUI matcher.\")\n        Container(matching_api, \"Matching APIs\", \"C#, .NET 8, MassTransit\", \"The barista service.\")\n        Container(auth_api, \"Auth APIs\", \"C#, .NET 8, MassTransit\", \"The authentication service.\")\n        Container(external_api, \"External Services\", \"C#, .NET 8, Marten\", \"Makes the outbound connections for other services\")\n\n        Boundary(b1, \"Docker containers\", \"boundary\") {\n            ContainerDb(cache, \"Storage\", \"Redis\", \"Stores bearer tokens for auth\")\n            Container(keyvault, \"KeyVault\", \"Azure Key Vault\", \"Storage of secret values\")\n        }\n    }\n    Container_Boundary(c2, \"NHS PDS FHIR API\") {\n        System(pds, \"PDS FHIR API\", \"The PDS service\")\n    }\n\n    Rel(laclient, reverse_proxy, \"Uses\", \"HTTPS\")\n    UpdateRelStyle(laclient, reverse_proxy, $offsetY=\"-20\")\n    Rel(reverse_proxy, matching_api, \"Proxies\", \"HTTP\")\n    Rel(auth_api, cache, \"Adds/checks Tokens\", \"HTTP\")\n    Rel(auth_api, keyvault, \"Gets Secrets\", \"HTTP\")\n    Rel(auth_api, pds, \"Authenticates\", \"HTTPS\")\n    UpdateRelStyle(auth_api, cache, $offsetX=\"30\")\n    Rel(external_api, cache, \"Gets Token\", \"HTTP\")\n    Rel(external_api, keyvault, \"Gets Secrets\", \"HTTP\")\n    Rel(external_api, pds, \"Retrieves NHS Number\", \"HTTPS\")\n    UpdateRelStyle(external_api, keyvault, $offsetX=\"40\", $offsetY=\"40\")\n    Rel(external_api, auth_api, \"Calls\", \"HTTP\")\n    Rel(matching_api, external_api, \"Calls\", \"HTTP\")\n\n</code></pre>"},{"location":"architecture/#services","title":"Services","text":""},{"location":"architecture/#matching","title":"matching","text":"<p>The matching service provides the ingress into the application. It also serves as the logic controller for the application. It accepts the following parameters:</p> <ul> <li>given name (required)</li> <li>family name (required)</li> <li>date of birth - which can be a range (required)</li> <li>gender</li> <li>postcode</li> <li>email address</li> <li>phone number</li> </ul> <p>Adapted from the schema specified here NHS PDS FHIR Schema.</p> <p>It validates these parameters meet the schema and then handles the logic for making external calls to the NHS in order to find a matching NHS number.</p> <p>Response 200:</p> <pre><code>{ \n    \"result\": {\n        \"matchStatus\": \"match\",\n        \"nhsNumber\": \"1234567890\",\n        \"processStage\": \"3\",\n        \"score\": \"0.96\"\n    },\n    \"dataQuality\": {\n        \"given\": \"valid\",\n        \"family\": \"valid\",\n        \"birthdate\": \"valid\",\n        \"addressPostalCode\": \"valid\",\n        \"phone\": \"invalid\",\n        \"email\": \"invalid\",\n        \"gender\": \"notProvided\"\n    }\n}\n</code></pre> <p>Result</p> Name Type Desc Values matchStatus string Match Result See Match Status table below. nhsNumber string nhsNumnber 10 digit string, empty string ProcessStage int stage of the process it exited at 0, 1, 2, 3 score number Score of the search 0.0 to 1.0 <p>Match Status</p> Name Desc match One match has been returned noMatch No match has been returned potentialMatch There is a potential match. One match with score above 0.85 and below 0.95 lowConfidenceMatch There is a low confidence match. One match with score but is below 0.85 manyMatch System returns mulitple matches <p>Data quality</p> Return Type Desc Valid string Data provided is valid Invalid string Data provided is invalid notProvided string No data was provided"},{"location":"architecture/#auth","title":"auth","text":"<p>Handles the secret key material in order to get the bearer token. It will use azure Key Vault to get the material needed to retrieve the bearer token. It will then store the bearer token in Redis to be accessed by the external service.</p>"},{"location":"architecture/#external","title":"external","text":"<p>Makes the external calls to the NHS PDS endpoints. Will get secrets from Key vault and bearer token from Redis.</p>"},{"location":"architecture/#search-criteria","title":"Search Criteria","text":"<p>Below there is reference to scoring. This scoring is the confidence score that is returned by the NHS when we perform a search. More information can be found about that in the scoring section here: PDS FHIR Search</p> <pre><code>---\ntitle: Matching conditions flow\n---\nstateDiagram-v2\n    clean: Canonicalise/clean data\n    apply_match_conditions: Apply Match Conditions\n    if_single_match: Single Match found\n    if_no_match_state: No Match found\n    confirmed_match: Confirmed Match\n    potential_match: Potential Match\n    low_confidence_match: Low Confidence Match\n    no_match: no match\n    manual_process: Manual Process\n    multiple_match: Multiple Matches\n    [*] --&gt; clean\n    clean --&gt; apply_match_conditions\n    apply_match_conditions --&gt; if_single_match\n    apply_match_conditions --&gt; multiple_match\n    multiple_match --&gt; manual_process: No NHS number\n    if_single_match --&gt; confirmed_match: if &gt;= 95% confident\n    if_single_match --&gt; potential_match: if &lt; 95% and &gt;= 85% confident\n    if_single_match --&gt; low_confidence_match: if &lt; 85% confident\n    confirmed_match --&gt; [*]: has NHS number\n    potential_match --&gt; manual_process: has NHS number\n    low_confidence_match --&gt; manual_process: has NHS number\n    apply_match_conditions --&gt; if_no_match_state\n    if_no_match_state --&gt; apply_match_conditions: if more match conditions\n    if_no_match_state --&gt; no_match: if no more match conditions\n    no_match --&gt; manual_process: No NHS number\n    manual_process --&gt; [*]\n\n</code></pre>"},{"location":"architecture/#data-overview","title":"Data Overview","text":"<p>This section is a work in progress...</p> <p>This project will collect anonymous data about the process. For each record that is sent to the service we will record information on the following:</p> <ul> <li>Data Quality</li> <li>Match Result</li> <li>Match Result Process Info</li> <li>Age Range</li> </ul> <p>This will allow for aggregate information to be collated and an evaluation on the process overall to be viewed.</p> <p>This information will be collated via log messages.</p> <p>No PII will be recorded.</p>"},{"location":"architecture/#non-functional-requirements","title":"Non Functional Requirements","text":"<p>Placeholder</p>"},{"location":"architecture/#non-functional-priorities","title":"Non Functional Priorities","text":"<p>The Non-Functional Priorities for the pilot are listed below.</p> <ol> <li>Security - Very sensitive data must be protected.</li> <li>Usability - Easy for both internal teams and external partners (e.g., Local Authorities) to use and adopt.</li> <li>Compatibility - Integration with existing systems like the NHS and Local Authority ecosystems.</li> <li>Maintainability - Highly iterative development process anticipated.</li> <li>Reliability - Not initially business-critical. Reliable enough for the pilot phase.</li> <li>Performance - Handling relatively small workloads during the pilot phase.</li> <li>Availability - Emphasis on maintenance and ensuring sufficient uptime.</li> <li>Portability - Targeted at limited settings for the pilot.</li> <li>Scalability - May scale from 1 to 4 Local Authorities (LAs) quickly, this would require these priorities to    change. Future hosting patterns to be reviewed.</li> </ol>"},{"location":"cicd/","title":"CI/CD","text":""},{"location":"cicd/#environments","title":"Environments","text":"<ul> <li>Local</li> <li>Dev (pipeline)</li> <li>Integration</li> <li>Staging (local authority)</li> <li>Production (local authority)</li> </ul> <p>Local: Ability to spin up the environment and connect to the NHS integration environment in order to run integration tests or test the API for example returns.</p> <p>Dev: This referes to the environment that exists in our CI pipelines. All external dependencies should be stubbed out and no secret material needed.</p> <p>Integration: Static integration environment updated at every morning. Connects out to the NHS integration environment.</p> <p>Staging: Located within a local authority and allows for testing deployments before running in prod.</p> <p>Production: Live environment in prod running against real data.</p>"},{"location":"cicd/#environment-progression","title":"Environment Progression","text":"<p>There may be differences in how deployment is done in the different local authorities.</p> <p>The below diagram looks at how environments are structured up until staging and production.</p> <pre><code>%%{init: { 'logLevel': 'debug', 'theme': 'base', 'gitGraph': {'showBranches': true, 'showCommitLabel':true,'mainBranchName': 'Local'}} }%%\n      gitGraph\n        commit id:\"Push to Github\"\n        branch Dev\n        commit id:\"Successful Build\"\n        commit id:\"Version Tagged\"\n        commit id:\"Bicep Files Created\"\n        branch Integration\n        commit id:\"Integration Rebuilt\"\n        commit type: HIGHLIGHT id:\"Environment Up\"\n        commit id:\"Integration Testing and Assurance\"\n        commit type:REVERSE id:\"Release Artifact Tagged\"\n</code></pre>"},{"location":"cicd/#deployment","title":"Deployment","text":"<p>To be tested... Looking at using bicep files output from the aspire framework and built using github actions. This will be the case for development. For staging and production we will potentially need a different way.</p> <p>Currently, the deployment uses the saved bicep files to run the deployment. The bicep files are out of sync with what the aspire generator produces so currently if you need to add anything to the deployment it will have to be done manually.</p>"},{"location":"clientarchitecture/","title":"Client Architecture","text":""},{"location":"clientarchitecture/#high-level-view","title":"High Level View","text":"<p>The client is a file processing application which watches for files in a directory, processes it and makes requests to the SUI application based on the records.</p>"},{"location":"clientarchitecture/#assumptions","title":"Assumptions","text":"<ul> <li>Input file format will be a CSV.</li> <li>Files will be located in a directory on a server.</li> <li>Client will have direct network access to the server.</li> <li>All communication will be internal to Azure.</li> </ul>"},{"location":"clientarchitecture/#features","title":"Features","text":""},{"location":"clientarchitecture/#file-watcher","title":"File Watcher","text":"<p>Watches a directory for a file. When file appears that matches the criteria it moves to load it.</p> <p>Configuration Options:</p> <ul> <li>File prefix</li> <li>File suffix</li> <li>Excluded files</li> <li>Modification time</li> </ul>"},{"location":"clientarchitecture/#cli-tool","title":"CLI Tool","text":"<p>Ability to run the tool via cmdline.</p>"},{"location":"clientarchitecture/#file-loader","title":"File Loader","text":"<p>Loads the file and checks initial configurations. Should assert that:</p> <ul> <li>File in format expected</li> <li>Expected field headings exist</li> </ul>"},{"location":"clientarchitecture/#record-handler","title":"Record Handler","text":"<p>Loops through each record to make a request to the SUI server.</p> <ul> <li>If required data fields not there it shouldn't make a request<ul> <li>Given</li> <li>Family</li> <li>DOB</li> </ul> </li> <li>Makes request to SUI server and waits for response.</li> </ul>"},{"location":"clientarchitecture/#response-handler","title":"Response Handler","text":"<p>Handles the response coming back from the server. Will need to handle the structure sent back from the server and format it. </p>"},{"location":"clientarchitecture/#outputs","title":"Outputs","text":"<p>Appends to the loaded CSV file with the NHS number if it existed.</p> <p>Writes a metadata file corresponding to the original file with additional information about the process:</p> <ul> <li>Data quality</li> <li>Validation issues</li> <li>Process stage it completed at</li> <li>Match status</li> <li>Match score</li> <li>Row number</li> </ul> <p>The metadata output file should be named the same as the data output file but with a metadata suffix.</p>"},{"location":"gettingstarted/","title":"Getting started","text":""},{"location":"gettingstarted/#setting-up-an-api-credential","title":"Setting up an API credential","text":"<ol> <li>On the NHS Developer site, create a new developer account, if you do not yet have one.</li> <li>Add a new application by going to environment access. Use the 'Integration test' and set yourself as the owner.</li> <li>Create a new API, linked to <code>Personal Demographics Service - Application-Restricted (Integration Testing)</code>. You will need to give this a globally unique name.</li> <li>Generate a keypair, by running these commands (from the NHS documentation)<ol> <li><code>KID=test-1</code></li> <li><code>openssl genrsa -out $KID.pem 4096</code></li> <li><code>openssl rsa -in $KID.pem -pubout -outform PEM -out $KID.pem.pub</code></li> <li><pre><code>MODULUS=$(\n   openssl rsa -pubin -in $KID.pem.pub -noout -modulus `# Print modulus of public key` \\\n   | cut -d '=' -f2                                    `# Extract modulus value from output` \\\n   | xxd -r -p                                         `# Convert from string to bytes` \\\n   | openssl base64 -A                                 `# Base64 encode without wrapping lines` \\\n   | sed 's|+|-|g; s|/|_|g; s|=||g'                    `# URL encode as JWK standard requires`\n   )</code></pre></li> <li><pre><code>echo '{\n     \"keys\": [\n       {\n         \"kty\": \"RSA\",\n         \"n\": \"'\"$MODULUS\"'\",\n         \"e\": \"AQAB\",\n         \"alg\": \"RS512\",\n         \"kid\": \"'\"$KID\"'\",\n         \"use\": \"sig\"\n       }\n     ]\n   }' &gt; $KID.json</code></pre></li> </ol> </li> <li>Upload the <code>test-1.json</code> file to your application's registration, on the 'Manage public key' page</li> <li>On the API portal, create a new API key, and copy the Key value. You do not need the secret. Then run the following command, using your Key value between the quotation marks.<ol> <li><code>API_KEY=\"IlmDF45AbP8Ao11pRtkK7tCoApApdABC\"</code></li> </ol> </li> <li>Create the <code>.env</code> file to provide these secrets to the mocked Azure Secret Manager, by running the following commands:<ol> <li><code>echo \"export NhsAuthConfig__NHS_DIGITAL_PRIVATE_KEY=\\\"$(openssl rsa -in $KID.pem -traditional -out -)\\\"\" &gt; .env</code></li> <li><code>echo \"export NhsAuthConfig__NHS_DIGITAL_KID=\\\"$KID\\\"\" &gt;&gt; .env</code></li> <li><code>echo \"export NhsAuthConfig__NHS_DIGITAL_CLIENT_ID=\\\"$API_KEY\\\"\" &gt;&gt; .env</code></li> </ol> </li> </ol> <p>If you're using an IDE (such as Jetbrains Rider), you can add these environment variables to the AppHost run configuration, as follows: </p>"},{"location":"gettingstarted/#pre-requisites","title":"Pre-requisites","text":"<p>You must install the .net CLI and v9 SDK. For macOS, run:</p> <pre><code>curl -sSL https://dot.net/v1/dotnet-install.sh | bash -s -- --version 9.0.102 --install-dir \"$HOME/.dotnet\"\necho 'export PATH=\"$HOME/.dotnet:$PATH\"' &gt;&gt; ~/.zshrc &amp;&amp; source ~/.zshrc &amp;&amp; echo $PATH\n</code></pre> <p>You should then be able to build the solution, using <pre><code>dotnet build sui-matching.sln\n</code></pre></p>"},{"location":"gettingstarted/#unit-and-integration-testing","title":"Unit and integration testing","text":"<ul> <li>To run the whole test suite via the terminal:</li> </ul> <pre><code>source .env\ndotnet test --settings tests.runsettings\n</code></pre> <p>or individually:</p> <pre><code>source .env\ncd sui-tests\ndotnet test &lt;path&gt;/&lt;to&gt;/&lt;test-class&gt;\n</code></pre>"},{"location":"gettingstarted/#running-locally","title":"Running locally","text":"<p>To build and run the project: <pre><code>dotnet build sui-matching.sln\ndotnet run --project src/app-host/AppHost.csproj\n</code></pre> Run simple test: <pre><code>curl -H 'Content-Type: application/json' \\\n      -d '{ \"given\":\"octavia\",\"family\":\"chislett\", \"birthdate\": \"2008-09-20\"}' \\\n      -X POST \\\n      http://localhost:5000/matching/api/v1/matchperson\n</code></pre> You should see a <code>matchStatus</code> of 0 if this has been successful. A <code>matchStatus</code> of 4 indicates that there has been an error connecting to the PDS API.</p> <p>If you have errors connecting to the aspire host page you may need to run the below commands: <pre><code>dotnet dev-certs https --clean\ndotnet dev-certs https --trust\n</code></pre></p>"},{"location":"waysof/","title":"Ways of Working","text":"<p>Quick intro into ways of working.</p>"},{"location":"waysof/#branching","title":"Branching","text":"<p>We follow basic branching practices. It follows the standard of prefix/ticket-number/headline-description.</p> <p>Prefix types can be:</p> <ul> <li>feature/: For developing new features.</li> <li>bugfix/: To fix bugs in the code.</li> <li>docs/: Used to write, modify or correct documentation.</li> </ul>"},{"location":"waysof/#pull-requests","title":"Pull Requests","text":"<p>Pull requests to be approved by one other member of the team. All tests should pass before merging. Merging to be done by the person who raises the pull request so that their name appears on the merge commit.</p>"},{"location":"waysof/#commit-messages","title":"Commit Messages","text":"<p>Commit messages should follow on from the branching standards.</p> <pre><code>&lt;type&gt;([ticket number]): &lt;description&gt;\n[body]\n</code></pre>"},{"location":"waysof/#cicd-aspirations","title":"CI/CD (Aspirations)","text":"<p>When infra up and running we can work out how to continually deploy to the integration environment within the DfE. </p>"},{"location":"waysof/#testing-aspirations","title":"Testing (Aspirations)","text":"<ul> <li>unit testing of features with no external dependencies.</li> <li>integration/e2e test to be performed on pull request. Data set to be developed to test the likely scenarios.</li> </ul>"},{"location":"waysof/#documentation","title":"Documentation","text":"<p>Documentation to be maintained in this repo and published to GitHub.</p>"},{"location":"strategies/rules/","title":"Rule Definitions","text":"<p>Please refer to the following definitions for the individual rules used within the search strategies.</p>"},{"location":"strategies/rules/#exact-all","title":"Exact All","text":"<p>Exact search with all provided values.</p> <p><code>_exact-match</code>=<code>true</code>,  <code>family</code>=<code>harley</code>,  <code>given</code>=<code>topper</code>,  <code>birthdate</code>=<code>eq1960-06-09</code>,  <code>gender</code>=<code>male</code></p>"},{"location":"strategies/rules/#exact-gfd","title":"Exact GFD","text":"<p>Exact search with given name, family name and DOB.</p> <p><code>_exact-match</code>=<code>true</code>,  <code>family</code>=<code>harley</code>, <code>given</code>=<code>topper</code>,  <code>birthdate</code>=<code>eq1960-06-09</code></p>"},{"location":"strategies/rules/#fuzzy-all","title":"Fuzzy All","text":"<p>Fuzzy search with all provided values.</p> <p><code>_fuzzy-match</code>=<code>true</code>, <code>family</code>=<code>harley</code>,  <code>given</code>=<code>topper</code>, <code>birthdate</code>=<code>eq1960-06-09</code>, <code>gender</code>=<code>male</code>, <code>address-postalcode</code>=<code>WN4 9BP</code></p>"},{"location":"strategies/rules/#fuzzy-gfd","title":"Fuzzy GFD","text":"<p>Fuzzy search with given name, family name, and date of birth.</p> <p><code>_fuzzy-match</code>=<code>true</code>,  <code>family</code>=<code>harley</code>,  <code>given</code>=<code>topper</code>,  <code>birthdate</code>=<code>eq1960-06-09</code></p>"},{"location":"strategies/rules/#fuzzy-gfd-postcode-wildcard","title":"Fuzzy GFD (Postcode Wildcard)","text":"<p>Fuzzy search with given name, family name, and date of birth, and postcode as wildcard.</p> <p><code>_fuzzy-match</code>=<code>true</code>,  <code>family</code>=<code>harley</code>,  <code>given</code>=<code>topper</code>,  <code>birthdate</code>=<code>eq1960-06-09</code>, <code>address-postalcode</code>=<code>WN*</code></p>"},{"location":"strategies/rules/#fuzzy-gfd-range","title":"Fuzzy GFD Range","text":"<p>Fuzzy search with given name, family name and DOB range 6 months either side of given date.</p> <p><code>_fuzzy-match</code>=<code>true</code>, <code>family</code>=<code>harley</code>,  <code>given</code>=<code>topper</code>,  <code>birthdate</code>=<code>ge1960-01-09</code>&amp;<code>birthdate</code>=<code>le1961-09-06</code></p>"},{"location":"strategies/rules/#fuzzy-gfd-range-postcode","title":"Fuzzy GFD Range (Postcode)","text":"<p>Fuzzy search with given name, family name, DOB range 6 months either side of given date, and postcode.</p> <p><code>_fuzzy-match</code>=<code>true</code>,  <code>family</code>=<code>harley</code>,  <code>given</code>=<code>topper</code>,  <code>birthdate</code>=<code>ge1960-01-09</code>&amp;<code>birthdate</code>=<code>le1960-07-09</code>, <code>address-postalcode</code>=<code>WN4 9BP</code></p>"},{"location":"strategies/rules/#fuzzy-gfd-range-postcode-wildcard","title":"Fuzzy GFD Range (Postcode Wildcard)","text":"<p>Fuzzy search with given name, family name, DOB range 6 months either side of given date, and postcode as wildcard.</p> <p><code>_fuzzy-match</code>=<code>true</code>,  <code>family</code>=<code>harley</code>,  <code>given</code>=<code>topper</code>,  <code>birthdate</code>=<code>ge1960-01-09</code>&amp;<code>birthdate</code>=<code>le1960-07-09</code>, <code>address-postalcode</code>=<code>WN*</code></p>"},{"location":"strategies/rules/#fuzzy-alt-dob","title":"Fuzzy Alt DOB","text":"<p>Fuzzy search with given name, family name and DOB. Day swapped with month if day equal to or less than 12.</p> <p><code>_fuzzy-match</code>=<code>true</code>, <code>family</code>=<code>harley</code>,  <code>given</code>=<code>topper</code>,  <code>birthdate</code>=<code>eq1960-09-06</code></p>"},{"location":"strategies/rules/#non-fuzzy-all","title":"Non-Fuzzy All","text":"<p>Non-fuzzy search with all provided values.</p> <p><code>_exact-match</code>=<code>false</code>, <code>family</code>=<code>harley</code>, <code>given</code>=<code>topper</code>,  <code>birthdate</code>=<code>eq1960-06-09</code>, <code>gender</code>=<code>male</code>, <code>address-postalcode</code>=<code>WN4 9BP</code>,  <code>history=true</code></p>"},{"location":"strategies/rules/#non-fuzzy-all-postcode-wildcard","title":"Non-Fuzzy All (Postcode Wildcard)","text":"<p>Non-fuzzy search with all provided values, and postcode as wildcard.</p> <p><code>_exact-match</code>=<code>false</code>, <code>family</code>=<code>harley</code>, <code>given</code>=<code>topper</code>, <code>birthdate</code>=<code>eq1960-06-09</code>, <code>address-postalcode</code>=<code>WN*</code>, <code>history=true</code></p>"},{"location":"strategies/rules/#non-fuzzy-gfd","title":"Non-Fuzzy GFD","text":"<p>Non-fuzzy search with given name, family name, and DOB.</p> <p><code>_exact-match</code>=<code>false</code>,  <code>family</code>=<code>harley</code>,  <code>given</code>=<code>topper</code>,  <code>birthdate</code>=<code>eq1960-06-09</code>,  <code>history=true</code></p>"},{"location":"strategies/rules/#non-fuzzy-gfd-postcode","title":"Non-Fuzzy GFD (Postcode)","text":"<p>Non-fuzzy search with given name, family name, DOB, and postcode.</p> <p><code>_exact-match</code>=<code>false</code>,  <code>family</code>=<code>harley</code>,  <code>given</code>=<code>topper</code>,  <code>birthdate</code>=<code>eq1960-06-09</code>, <code>address-postalcode</code>=<code>WN4 9BP</code>, <code>history=true</code></p>"},{"location":"strategies/rules/#non-fuzzy-gfd-range","title":"Non-Fuzzy GFD Range","text":"<p>Non-fuzzy search with given name, family name, and DOB range 6 months either side of given date.</p> <p><code>_exact-match</code>=<code>false</code>,  <code>family</code>=<code>harley</code>,  <code>given</code>=<code>topper</code>,  <code>birthdate</code>=<code>ge1960-01-09</code>&amp;<code>birthdate</code>=<code>le1960-07-09</code>, <code>history=true</code></p>"},{"location":"strategies/rules/#non-fuzzy-gfd-range-postcode","title":"Non-Fuzzy GFD Range (Postcode)","text":"<p>Non-fuzzy search with given name, family name, DOB range 6 months either side of given date, and postcode.</p> <p><code>_exact-match</code>=<code>false</code>, <code>family</code>=<code>harley</code>, <code>given</code>=<code>topper</code>, <code>birthdate</code>=<code>ge1960-01-09</code>&amp;<code>birthdate</code>=<code>le1960-07-09</code>, <code>address-postalcode</code>=<code>WN4 9BP</code>, <code>history=true</code></p>"},{"location":"strategies/rules/#non-fuzzy-gfd-range-postcode-wildcard","title":"Non-Fuzzy GFD Range (Postcode Wildcard)","text":"<p>Non-fuzzy search with given name, family name, DOB range 6 months either side of given date, and postcode as wildcard.</p> <p><code>_exact-match</code>=<code>false</code>, <code>family</code>=<code>harley</code>, <code>given</code>=<code>topper</code>, <code>birthdate</code>=<code>ge1960-01-09</code>&amp;<code>birthdate</code>=<code>le1960-07-09</code>, <code>address-postalcode</code>=<code>WN4 9BP</code>, <code>history=true</code></p>"},{"location":"strategies/strategies/","title":"Strategies","text":"<p>In order to find a record in PDS which matches the demographic data provided, we apply a set of rules. Each ordered combination of rules is referred to as a strategy. When these have minor improvements or bug fixes applied, a new version of this strategy is created and supercedes the previous version. When substantial changes are made, a new strategy is created.</p>"},{"location":"strategies/strategies/#key-definitions","title":"Key definitions","text":"<p>The following defitions are taken from NHS FHIR API Search.</p>"},{"location":"strategies/strategies/#fuzzy","title":"Fuzzy","text":"<p>A fuzzy search:</p> <ul> <li>matches common homophones, such as Smith and Smythe, using the Soundex algorithm</li> <li>checks for transposed names, such as Adam Thomas and Thomas Adam</li> <li>always searches history, such as previous names and addresses</li> </ul> <p>It is more likely to include multiple matches and false positives than a non-fuzzy search.</p>"},{"location":"strategies/strategies/#non-fuzzy","title":"Non-Fuzzy","text":"<p>A non-fuzzy search:</p> <ul> <li>allows wildcards in names and postcodes</li> <li>does not match homophones or transposed names</li> <li>can optionally search history, such as previous names and addresses</li> </ul> <p>It is less likely to return multiple matches than a fuzzy search.</p>"},{"location":"strategies/strategies/#exact","title":"Exact","text":"<p>An exact search will return a result if the demographic details match exactly. This might be useful if you are verifying an NHS number against details you already believe to be correct. It is unlikely to work well with wildcards or fuzzy search.</p>"},{"location":"strategies/strategies/#gfd","title":"GFD","text":"<p>Given name, Family name, Date of Birth.</p>"},{"location":"strategies/strategies/#postcode-wildcard","title":"Postcode wildcard","text":"<p>Searches the postcode with only the first two letters of the first half specified, widening the search when postcodes may be inaccurate.</p>"},{"location":"strategies/strategies/#strategies_1","title":"Strategies","text":""},{"location":"strategies/strategies/#strategy-1","title":"Strategy 1","text":"<ol> <li>Exact GFD</li> <li>Exact All</li> <li>Fuzzy GFD</li> <li>Fuzzy All</li> <li>Fuzzy GFD Range</li> <li>Fuzzy Alt DOB</li> </ol>"},{"location":"strategies/strategies/#strategy-2","title":"Strategy 2","text":"<p>Strategy 2 removes the exact searches from Strategy 1, and uses a large variation of fuzzy and non-fuzzy searches. The order of the queries is not optimized.</p> <ol> <li>Non Fuzzy GFD</li> <li>Non Fuzzy GFD Range</li> <li>Non Fuzzy All (Postcode Wildcard)</li> <li>Non Fuzzy All</li> <li>Fuzzy GFD</li> <li>Fuzzy GFD Range (Postcode Wildcard)</li> <li>Fuzzy GFD Range (Postcode)</li> <li>Fuzzy All</li> <li>Fuzzy Alt DOB</li> </ol>"},{"location":"strategies/strategies/#strategy-3","title":"Strategy 3","text":"<p>Strategy 3 went through many iterations during testing, and the three most recent versions are documented below. For more details, please see the full version history here.</p>"},{"location":"strategies/strategies/#version-14","title":"Version 14","text":"<ol> <li>Non-Fuzzy GFD</li> <li>Fuzzy GFD</li> <li>Fuzzy All </li> <li>Non-Fuzzy GFD Range</li> <li>Non-Fuzzy GFD Range (Postcode)</li> <li>Fuzzy GFD Range</li> <li>Fuzzy GFD Range (Postcode)</li> </ol>"},{"location":"strategies/strategies/#version-15","title":"Version 15","text":"<p>Adds postcode wildcard rules to the end of the search.</p> <ol> <li>Non-Fuzzy GFD</li> <li>Fuzzy GFD</li> <li>Fuzzy All </li> <li>Non-Fuzzy GFD Range</li> <li>Non-Fuzzy GFD Range (Postcode)</li> <li>Fuzzy GFD Range</li> <li>Fuzzy GFD Range (Postcode)</li> <li>Non-Fuzzy GFD Range (Postcode Wildcard)</li> <li>Fuzzy GFD Range (Postcode Wildcard)</li> </ol>"},{"location":"strategies/strategies/#version-16","title":"Version 16","text":"<p>Adds a postcode field to the initial rule of V15.</p> <ol> <li>Non-Fuzzy GFD (Postcode)</li> <li>Fuzzy GFD</li> <li>Fuzzy All </li> <li>Non-Fuzzy GFD Range</li> <li>Non-Fuzzy GFD Range (Postcode)</li> <li>Fuzzy GFD Range</li> <li>Fuzzy GFD Range (Postcode)</li> <li>Non-Fuzzy GFD Range (Postcode Wildcard)</li> <li>Fuzzy GFD Range (Postcode Wildcard)</li> </ol>"},{"location":"strategies/strategies/#strategy-4","title":"Strategy 4","text":"<p>Strategy 4 takes version 14 of Strategy 3, splits the given name into an array, and passes them to PDS as multiple given names.</p> <ol> <li>Non Fuzzy GFD</li> <li>Fuzzy GFD</li> <li>Fuzzy All</li> <li>Non Fuzzy GFD Range</li> <li>Non Fuzzy GFD Range (Postcode)</li> <li>Fuzzy GFD Range</li> <li>Fuzzy GFD Range (Postcode)</li> </ol>"},{"location":"strategies/strategies/#return-results","title":"Return Results","text":"<p>Each query to PDS via the matcher returns one of the following results:</p>"},{"location":"strategies/strategies/#nhs_num","title":"NHS_NUM","text":"<p>A confident match to a single NHS number has been found, and that number is returned.</p>"},{"location":"strategies/strategies/#no_match","title":"NO_MATCH","text":"<p>There are no entries in PDS which could be matched to the NHS number. This may suggest that the demographic information provided does not represent anyone stored within PDS, or that either PDS or the searcher contain inaccurate demographic information.</p>"},{"location":"strategies/strategies/#potential_match","title":"POTENTIAL_MATCH","text":"<p>A match was found in PDS which does not meet the confident match criteria, but is close to that criteria. This may indicate a slight difference in demographic information.</p>"},{"location":"strategies/strategies/#low_confidence_match","title":"LOW_CONFIDENCE_MATCH","text":"<p>Only one entry in PDS was found to contain any demographic information in common, but the records are different enough to cast doubt on the certainty of the match. This may indicate out-of-date demographic information, such as a name or address change.</p>"},{"location":"strategies/strategies/#many_matches","title":"MANY_MATCHES","text":"<p>Multiple entries in PDS could be matched to the demographic information given. This may indicate duplicate entries in PDS, or that the person is linked to multipl NHS numbers.</p>"},{"location":"strategies/strategy3/","title":"Strategy 3 Full Version History","text":""},{"location":"strategies/strategy3/#version-1","title":"Version 1","text":"<p>Simplest test to establish a baseline using all fields in both fuzzy and non-fuzzy searches.</p> <ol> <li>Non-Fuzzy All</li> <li>Fuzzy All</li> </ol>"},{"location":"strategies/strategy3/#version-2","title":"Version 2","text":"<p>Adds an additional postcode wildcard rule to V1.</p> <ol> <li>Non-Fuzzy All (Postcode Wildcard)</li> <li>Non-Fuzzy All</li> <li>Fuzzy All</li> </ol>"},{"location":"strategies/strategy3/#version-3","title":"Version 3","text":"<p>Adds an additional fuzzy postcode wildcard rule to V2.</p> <ol> <li>Non-Fuzzy All (Postcode Wildcard)</li> <li>Non-Fuzzy All</li> <li>Fuzzy GFD (Postcode Wildcard)</li> <li>Fuzzy All</li> </ol>"},{"location":"strategies/strategy3/#version-4","title":"Version 4","text":"<p>Adds a non-fuzzy GFD with DOB range rule to V1.</p> <ol> <li>Non-Fuzzy GFD Range</li> <li>Non-Fuzzy All</li> <li>Fuzzy All</li> </ol>"},{"location":"strategies/strategy3/#version-5","title":"Version 5","text":"<p>Adds a fuzzy GFD with DOB range rule to V1.</p> <ol> <li>Fuzzy GFD Range</li> <li>Non-Fuzzy All</li> <li>Fuzzy All</li> </ol>"},{"location":"strategies/strategy3/#version-6","title":"Version 6","text":"<p>Adds a postcode field to the first rule in V4.</p> <ol> <li>Non-Fuzzy GFD Range (Postcode)</li> <li>Non-Fuzzy All</li> <li>Fuzzy All</li> </ol>"},{"location":"strategies/strategy3/#version-7","title":"Version 7","text":"<p>Adds an additional postcode wildcard rule to V6.</p> <ol> <li>Non-Fuzzy GFD Range (Postcode)</li> <li>Non-Fuzzy GFD Range (Postcode Wildcard)</li> <li>Non-Fuzzy All</li> <li>Fuzzy All</li> </ol>"},{"location":"strategies/strategy3/#version-8","title":"Version 8","text":"<p>Changes the first two rules in V7 to be fuzzy.</p> <ol> <li>Fuzzy GFD Range (Postcode)</li> <li>Fuzzy GFD Range (Postcode Wildcard)</li> <li>Non-Fuzzy All</li> <li>Fuzzy All</li> </ol>"},{"location":"strategies/strategy3/#version-9","title":"Version 9","text":"<p>Combines the first two steps of V7 and V8 to have non-fuzzy and fuzzy searches.</p> <ol> <li>Non-Fuzzy GFD Range (Postcode)</li> <li>Non-Fuzzy GFD Range (Postcode Wildcard)</li> <li>Fuzzy GFD Range (Postcode)</li> <li>Fuzzy GFD Range (Postcode Wildcard)</li> <li>Non-Fuzzy All</li> <li>Fuzzy All</li> </ol>"},{"location":"strategies/strategy3/#version-10","title":"Version 10","text":"<p>Adds fuzzy and non-fuzzy GFD searches to V9 and separates fuzzy and non-fuzzy searching, ordered for performance within each category.</p> <ol> <li>Non-Fuzzy GFD</li> <li>Non-Fuzzy GFD Range (Postcode)</li> <li>Non-Fuzzy GFD Range (Postcode Wildcard)</li> <li>Non-Fuzzy All</li> <li>Fuzzy GFD</li> <li>Fuzzy GFD Range (Postcode)</li> <li>Fuzzy GFD Range (Postcode Wildcard)</li> <li>Fuzzy All</li> </ol>"},{"location":"strategies/strategy3/#version-11","title":"Version 11","text":"<p>Re-orders the rules from V10 for performance, removing postcode wildcards, and adding non-fuzzy GFD range.</p> <ol> <li>Non-Fuzzy GFD</li> <li>Non-Fuzzy GFD Range</li> <li>Fuzzy GFD</li> <li>Fuzzy All</li> <li>Non-Fuzzy GFD Range (Postcode)</li> <li>Fuzzy GFD Range (Postcode)</li> <li>Non-Fuzzy All</li> </ol>"},{"location":"strategies/strategy3/#version-12","title":"Version 12","text":"<p>Re-orders the rules from V11 by most matches found.</p> <ol> <li>Non-Fuzzy GFD</li> <li>Fuzzy GFD</li> <li>Fuzzy All</li> <li>Non-Fuzzy GFD Range</li> <li>Non-Fuzzy GFD Range (Postcode)</li> <li>Fuzzy GFD Range (Postcode)</li> <li>Non-Fuzzy All</li> </ol>"},{"location":"strategies/strategy3/#version-13","title":"Version 13","text":"<p>Adds \"Fuzzy GFD Range\" to V12. Removes \"Non-Fuzzy All\" as it found no additional records in V11 and V12.</p> <ol> <li>Non-Fuzzy GFD</li> <li>Fuzzy GFD</li> <li>Fuzzy All</li> <li>Non-Fuzzy GFD Range</li> <li>Fuzzy GFD Range</li> <li>Non-Fuzzy GFD Range (Postcode)</li> <li>Fuzzy GFD Range (Postcode)</li> </ol>"},{"location":"strategies/strategy3/#version-14","title":"Version 14","text":"<p>Moves \"Fuzzy GFD Range\" down as it found fewer result than \"Non-Fuzzy GFD Range (Postcode)\".</p> <ol> <li>Non-Fuzzy GFD</li> <li>Fuzzy GFD</li> <li>Fuzzy All</li> <li>Non-Fuzzy GFD Range</li> <li>Non-Fuzzy GFD Range (Postcode)</li> <li>Fuzzy GFD Range</li> <li>Fuzzy GFD Range (Postcode)</li> </ol>"},{"location":"strategies/strategy3/#version-15","title":"Version 15","text":"<p>Adds postcode wildcard rules to the end of V14.</p> <ol> <li>Non-Fuzzy GFD</li> <li>Fuzzy GFD</li> <li>Fuzzy All</li> <li>Non-Fuzzy GFD Range</li> <li>Non-Fuzzy GFD Range (Postcode)</li> <li>Fuzzy GFD Range</li> <li>Fuzzy GFD Range (Postcode)</li> <li>Non-Fuzzy GFD Range (Postcode Wildcard)</li> <li>Fuzzy GFD Range (Postcode Wildcard)</li> </ol>"},{"location":"strategies/strategy3/#version-16","title":"Version 16","text":"<p>Adds a postcode field to the initial rule of V15.</p> <ol> <li>Non-Fuzzy GFD (Postcode)</li> <li>Fuzzy GFD</li> <li>Fuzzy All</li> <li>Non-Fuzzy GFD Range</li> <li>Non-Fuzzy GFD Range (Postcode)</li> <li>Fuzzy GFD Range</li> <li>Fuzzy GFD Range (Postcode)</li> <li>Non-Fuzzy GFD Range (Postcode Wildcard)</li> <li>Fuzzy GFD Range (Postcode Wildcard)</li> </ol>"}]}